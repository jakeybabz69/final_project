---
title: "Measuring National Well-being"
author: "Jake Wilson"
date: "29/03/2022"
output: html_document
---

#### Introduction
This page will show how I used data from the Office of National Statistics to create a map of depression in the UK. This is for the module PSY6422 Data Management and Visualisation as part of an MSc in Cognitive Neuroscience and Human Neuroimaging. Please see all relevent data in my github repositry [here](https://github.com/jakeybabz69/). My idea for this project was to project **depression data** on a map of the **United Kingdom** and compare the scores across different regions using a colour scale to represent higher and lower symptoms of depression.

#### Data Origins
The data sets can be found on the [ONS website](https://www.ons.gov.uk/peoplepopulationandcommunity/wellbeing/datasets/measuringnationalwellbeingdomainsandmeasures). I didn't want my data to be affected by the SARS-CoV-2 pandemic and wanted it to represent *normal* conditions in the UK. Unfortunately the ONS does not have data past 2016 but before the SARS-CoV-2 pandemic but the data is suitable regardless.

Both map data files are also produced by the ONS on their [open geography website](https://geoportal.statistics.gov.uk). The map data files containing regions can be found [here](https://geoportal.statistics.gov.uk/datasets/ons::regions-december-2021-en-bfc/explore?location=52.837548%2C-2.489483%2C7.01) and the data containing countries can be found [here](https://geoportal.statistics.gov.uk/datasets/ons::countries-december-2021-uk-bfc/explore?location=55.340000%2C-3.316939%2C6.03). These essentially give coordinated for r to use to construct a map of the UK.

#### Research Question
My data attempts to educate people on how depression across the UK. Before I did this data visualisation, I could only guess at places with lower/higher levels of depression. Looking at the ONS data gave some indication however, mapping the data made it much more clear. 

Below are the libraries needed for the project to run correctly.

```{r}
library(tidyverse)
library(readxl)
library(tinytex)
library(here)
library(scales)
library(maps)
library(mapdata)
library(maptools)
library(rgdal)
library(ggmap)
library(ggplot2)
library(rgeos)
library(broom)
library(RColorBrewer)
library(dplyr)
```

#### Data Preparation
```{r}
#find ONS data file
file <- here(
  "data",
  "domainsandmeasuresautumn2019.xls"
  )
excel_sheets(
  file
  )

```
It's clear a lot of work is needed!

*Tasks
 +There are several sheets but I only need one.
 +The sheet contains a lot of useles information for my plot
 +The columns are inapproriately named, especially to work with the map data
 +One region name doesn't match the corresponding region in the map data

```{r}
#read excel sheet
df_uk <- read_excel(
  file,
  "3.4 Psychosocial health"
  ) %>%

#extracts the data from df of regions in the UK
  slice(
    36:48
    ) %>%

#renames columns to a meaningful value and also to work with the map data (see below)
  rename(
    "id" = "National Well-being Measures, October 2019 release",
    "people" = "...2"
    ) %>%
  
#renames East to East of England to match the shapefile data (see below)
  mutate(
    id=recode(
      id,
      East="East of England"
      ))

```

The ONS depression data is now ready to be used! Next the map data needs to be manipulated.
Note: map data of regions of England as well as countries in the UK are included as the ONS depression data file contains both. There is not one file with both on the ONS website so this has to be dealt with.
```{r}
#load shapefile of England's regions
shapefile_regions <- readOGR(
  here(
    "data",
    "RGN_DEC_2021_EN_BFC.shp"
    ))

#reshape England shapefile so ggplot can interpret it
mapdata_regions <- tidy(
  shapefile_regions,
  region = "RGN21NM"
  )

#load shapefile of the rest of the UK
shapefile_uk <- readOGR(
  here(
  "data",
  "CTRY_DEC_2021_UK_BFC.shp"
  ))

#reshape UK shapefile into a tidy data frame so ggplot can interpret it
mapdata_uk <- tidy(
  shapefile_uk,
  region = "CTRY21NM"
  )
```


There are again problems.
*Tasks
 +remove England from the country data.
 +combine mapdata to remove the England gap
 +add ONS depression data to plot map data with it
 +plot map

```{r}

#removes England from mapdata_uk as we already have the regions of the UK
mapdata_uk_noeng <- mapdata_uk[
  -c(
    1:1245839
    )
  ,
  ]

#combines both mapdata dfs
combined_mapdata <- bind_rows(
  mapdata_uk_noeng,
  mapdata_regions
  ) %>%

#adds ONS depression data to shapefiles
inner_join(
  df_uk,
  by="id"
  ) %>%

#defines the people column as a numeric vector
mutate(people = as.numeric(
  people
  ))
```

#### Data Visualisation
The problems don't stop there!
*Tasks
 +The map plots on a grid, has labels for axis and ticks on the axis that need removing.
 +An appropriate title needs to be given to the graph and to the legend
 +As it stands, the legend shows darker colours as a lower percentage of depression which is counterintuitive
 +It's hard to see some boundaries with some of the regions in England.
```{r}
#create plot, removes grid and axis and adds labels
map <- ggplot() + 
  theme(
    panel.grid = element_blank()) + 
  theme(
    axis.ticks = element_blank(),
    axis.text = element_blank()) +
  labs(
    x=element_blank(),
    y=element_blank(),
    title = "Prevalence of Depression across the United Kingdom",
    fill = "People (%)")

#change to more appropriate colours and plots graph
map + geom_polygon(
  data = combined_mapdata,
  aes(
    x = long,
    y = lat,
    group = group,
    fill = people
    ),
  colour = "white",
  size = 0.01
  ) +
  coord_fixed(
    1
              ) +
  scale_fill_gradientn(
    colours = c(
      "#d9f1ff",
      "#59bfff",
      "#009dff",
      "#000137",
      "#000817"
      ),
    values = scales::rescale(
      c(15,16,17,18)
      ))
       
#saves plot to directory
ggsave(filename = "depression_uk.png")
```
#### Summary
In summary, I have used publicly available data to create a plot of prevalence of depression across the UK.

From the graph it is clear that:
* Northern Ireland has the lowest prevalence of depression
* The North East and West Midlands have the highest rates although it is unclear which is higher.

If I had more time on this project I would include counties as opposed to regions. This would enable readers to see the distribution of depression over the UK in more detail. I did find data for Clinical Commissioning Groups (CCG) which is essentially areas the NHS covers over counties however I couldn't find a suitable shapefile that matched, despite finding a CCG shapefile. To use that shapefile I would have had to ammend over approximately 100 CCG rows or find depression data for each county, which I couldn't.

I would have also compared this data across multiple time-points and so produce multiple maps.
