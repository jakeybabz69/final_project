---
title: "map branch"
author: "Jake Wilson"
date: "29/03/2022"
output: html_document
---

# Measuring National Well-being in 2019
##Introduction

My *intial idea* for this project was to project depression scores on a map of the United Kingdom and compare the scores across different counties using a colour scale to represent higher and lower symptoms of depression.

After looking at data on the [ONS website](https://www.ons.gov.uk/peoplepopulationandcommunity/wellbeing/datasets/measuringnationalwellbeingdomainsandmeasures) I realised that the data was separated in **spring** and **autumn**. This gave me the idea to merge my initial idea and also to compare the data between seasons. This would also give me the opportunity to give some interesting visualisation to the graph by using autumnal colours and spring colours in the colour scale.

##Data

Below are the libraries for the project

```{r, warning=FALSE}
#code to make a graph
library(tidyverse)
#code to read xls files
library(readxl)
#code to convert rmd file to pdf
library(tinytex)
#code to make make code more accessible
library(here)

library(maps)
library(mapdata)
library(maptools)
library(rgdal)
library(ggmap)
library(ggplot2)
library(rgeos)
library(broom)
library(dplyr)


```
 
Below is the data for the initial plot

```{r} 
#load from my computer
#fetch names of the sheets
file <- here("data","domainsandmeasuresautumn2019.xls")
excel_sheets(file)

#read the csv file
df_autumn <- read_excel(
  file, "3.4 Psychosocial health")

#extracts only the data from rows 12 to 28 ie the rows about depression across the years and reassigns it
depression_by_year <- df_autumn %>% slice(13:27)

#removes the confidence interval columns
dby_mod <- depression_by_year %>% select(-c(...3,...4))

#renames columns to meaningful values
colnames(dby_mod) <- c("year","people")

#takes off values after the initial year
dby_mod <- dby_mod %>% 
  mutate(year = str_sub(year,1,4))

#changes columns to integer values
class(dby_mod$year)="integer"
class(dby_mod$people)="integer"

#creates plot using depression data
p <- ggplot(
  data=dby_mod,
  mapping=aes(
    x=year,
    y=people))

#plots and labes graph
p + 
  geom_line()+
  ggtitle("Depression in the UK over the years") +
  ylab("People (%)")
```

#Plotting maps

Now I will plot depression data on a map of the UK. The shapefile data containing regions is [here](https://geoportal.statistics.gov.uk/datasets/ons::regions-december-2021-en-bfc/explore?location=52.837548%2C-2.489483%2C7.01) and the data containing countries is here [https://geoportal.statistics.gov.uk/datasets/ons::countries-december-2021-uk-bfc/explore?location=55.340000%2C-3.316939%2C6.03]

https://datatricks.co.uk/creating-maps-in-r

```{r}
#extracts the data from df_autumn of regions in the UK
depression_by_region <- df_autumn %>% slice(36:48)

#removes the confidence interval columns
dbr_mod <- depression_by_region %>% select(-c(...3,...4))

#renames columns to a meaningful value and also to work with the shapefile data (see below)
colnames(dbr_mod) <- c("id","people")

#load shapefile of England's regions
shapefile_regions <- readOGR(
  here("data","RGN_DEC_2021_EN_BFC.shp"))

#reshape England shapefile so ggplot can interpret it
mapdata_regions <- tidy(
  shapefile_regions,
  region = "RGN21NM")

#renames East to East of England to match the shapefile data 
dbr_mod <- dbr_mod %>%
  mutate(
    id=recode(
      id,East="East of England"))

#load shapefile of the rest of the UK
shapefile_uk <- readOGR(
  here("data","CTRY_DEC_2021_UK_BFC.shp"))

#reshape UK shapefile so ggplot can interpret it
mapdata_uk <- tidy(
  shapefile_uk,
  region = "CTRY21NM")

#removes England from mapdata_uk as we already have the regions of the UK
mapdata_uk_noeng <- mapdata_uk[-c(1:1245839),]

#combines both mapdata dfs
combined_mapdata <- bind_rows(mapdata_uk_noeng,mapdata_regions)

#adds NHS data to shapefiles
combined_mapdata <- inner_join(
  combined_mapdata,
  dbr_mod,
  by="id")

#defines the people column as a numeric vector
class(combined_mapdata$people)="numeric"

#create plot, removes grid and axis and adds labels
map <- ggplot() + 
  theme(
  panel.grid = element_blank()) + 
  theme (
    axis.ticks = element_blank(),
    axis.text = element_blank()) +
  labs(
    x=element_blank(),
    y=element_blank(),
    title = "Autumn depression in the United Kingdom",
    fill = "People (%)")


#change to more appropriate colours and plots graph
map + geom_polygon(
  data = combined_mapdata,
  aes(
    x = long,
    y = lat,
    group = group,
    fill = people),
  colour = "white",
  size = 0.01) +
  coord_fixed(1)+
  scale_fill_gradient(
    low = "#F9E076",
    high = "#FA8128")

```

